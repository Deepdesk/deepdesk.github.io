<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Example</title>
    <style>
        #input {
            width: 400px;
            height: 100px;
            margin-top: 500px;
        }
    </style>
</head>
<body>
    <form id="form">
        <textarea id="input">Goe</textarea>
    </form>

    <script type="application/javascript" src="./deepdesk-sdk-v4.2.6.min.js"></script>
    <script>
        const { DeepdeskSDK, createOverlayContainer, Theme } = window.DeepdeskSDK;
        const formElement = document.getElementById('form');
        const inputElement = document.getElementById('input');

        const deepdeskSdk = new DeepdeskSDK({
            deepdeskUrl: `https://f0384fb22ec0.eu.ngrok.io/api`,
            enableConversationSuggestions: true,
            enableHotkeys: false,
            platform: 'exmaple',
            nrTextSuggestions: 3,
            nrUrlSuggestions: 0,
            version: 'example',
            enableTabCompletion: true,
        });

        /*
         * Create conversation
         */
        deepdeskSdk.createConversation({
            channel: 'chat', // chat or messaging
            sessionId: '1', // platform's conversation identifier
            agentId: '1', // platform's agent identifier
            platform: 'example', // name of platform
        }, () => {
            /*
             * Notify SDK of initial input
             */
            const currentInput = inputElement.value;

            if (currentInput) {
                deepdeskSdk.notifyInputChanged(currentInput);
            }

            /*
             * Set input text helper
             */
            let isSettingValue = false;

            const setValue = text => {
                isSettingValue = true;
                inputElement.value = text;
                inputElement.dispatchEvent(new Event('input', { bubbles: true }));
                isSettingValue = false;
            };

            /*
             * Bind UI events -> SDK
             */
            inputElement.addEventListener('input', event => {
                if (isSettingValue) return; // It's us, ignore the change

                deepdeskSdk.notifyInputChanged(event.target.value);
            });

            inputElement.addEventListener('keydown', event => {
                deepdeskSdk.notifyKeyDown(event);
            });

            inputElement.addEventListener('paste', event => {
                deepdeskSdk.notifyPaste(event);
            });

            inputElement.addEventListener('cut', event => {
                deepdeskSdk.notifyCut(event);
            });

            formElement.addEventListener('submit', () => {
                if (!inputElement.value) return;

                deepdeskSdk.notifyMessageAgent();
            });

            /*
             * Bind SDK -> UI view
             */
            deepdeskSdk.on('UseTextSuggestion', suggestion => {
                inputElement.focus();
                setValue(suggestion.text);
            });

            deepdeskSdk.on('UseUrlSuggestion', suggestion => {
                inputElement.focus();
                setValue(inputElement.value + suggestion.text);
            });

            deepdeskSdk.on('UseStickyMessage', suggestion => {
                inputElement.focus();
                setValue(inputElement.value + suggestion.text);
            });

            deepdeskSdk.on('UseExternalSuggestion', suggestion => {
                inputElement.focus();
                setValue(inputElement.value + suggestion.text);
            });

            deepdeskSdk.on('Reset', value => {
                inputElement.focus();
                setValue(value.text);
            });

            /*
             * Create overlay with autocomplete suggestions
             */
            const containerElement = createOverlayContainer(inputElement);
            const overlayElement = document.createElement('div');

            overlayElement.style.position = 'absolute';
            overlayElement.style.bottom = '100%';
            overlayElement.style.width = '100%';
            overlayElement.style.pointerEvents = 'auto';
            containerElement.appendChild(overlayElement);

            deepdeskSdk.createAutocomplete(overlayElement, {
                showToggleButton: true,
            });

            /*
             * Create inline tabcomplete
             */
            deepdeskSdk.createTabCompletion(inputElement);
        });
    </script>
</body>
</html>